'use client';
import{forwardRef as de,useCallback as K,useEffect as E,useImperativeHandle as le,useMemo as pe,useRef as F,useState as X}from"react";import{forwardRef as ie}from"react";import{jsx as ce}from"react/jsx-runtime";var se=({as:r="div",...c},o)=>ce(r,{...c,ref:o}),V=ie(se);import{useEffect as ae,useState as ue}from"react";var Y="https://challenges.cloudflare.com/turnstile/v0/api.js",w="cf-turnstile-script",A="cf-turnstile",S="onloadTurnstileCallback",D=r=>!!document.getElementById(r),q=({render:r="explicit",onLoadCallbackName:c=S,scriptOptions:{nonce:o="",defer:e=!0,async:p=!0,id:x="",appendTo:C,onError:v,crossOrigin:I=""}={}})=>{let R=x||w;if(D(R))return;let i=document.createElement("script");if(i.id=R,i.src=`${Y}?onload=${c}&render=${r}`,document.querySelector(`script[src="${i.src}"]`))return;i.defer=!!e,i.async=!!p,o&&(i.nonce=o),I&&(i.crossOrigin=I),v&&(i.onerror=v,delete window[c]),(C==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(i)},l={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function J(r){if(r!=="invisible"&&r!=="interactionOnly")return r}function O(r=w){let[c,o]=ue(!1);return ae(()=>{let e=()=>{D(r)&&o(!0)},p=new MutationObserver(e);return p.observe(document,{childList:!0,subtree:!0}),e(),()=>{p.disconnect()}},[r]),c}import{jsx as we}from"react/jsx-runtime";var b="unloaded",G,fe=new Promise((r,c)=>{G={resolve:r,reject:c},b==="ready"&&r(void 0)}),me=(r=S)=>(b==="unloaded"&&(b="loading",window[r]=()=>{G.resolve(),b="ready",delete window[r]}),fe),Te=de((r,c)=>{let{scriptOptions:o,options:e={},siteKey:p,onWidgetLoad:x,onSuccess:C,onExpire:v,onError:I,onBeforeInteractive:R,onAfterInteractive:i,onUnsupported:N,onTimeout:Q,onLoadScript:U,id:Z,style:ee,as:te="div",injectScript:M=!0,...re}=r,s=e.size,z=K(()=>typeof s>"u"?{}:e.execution==="execute"?l.invisible:e.appearance==="interaction-only"?l.interactionOnly:l[s],[e.execution,s,e.appearance]),[ne,y]=X(z()),a=F(null),[f,W]=X(!1),t=F(),h=F(!1),$=Z||A,P=o?.id||w,L=O(P),j=o?.onLoadCallbackName||S,oe=e.appearance||"always",g=pe(()=>({sitekey:p,action:e.action,cData:e.cData,callback:n=>{h.current=!0,C?.(n)},"error-callback":I,"expired-callback":v,"before-interactive-callback":R,"after-interactive-callback":i,"unsupported-callback":N,theme:e.theme||"auto",language:e.language||"auto",tabindex:e.tabIndex,"response-field":e.responseField,"response-field-name":e.responseFieldName,size:J(s),retry:e.retry||"auto","retry-interval":e.retryInterval||8e3,"refresh-expired":e.refreshExpired||"auto","refresh-timeout":e.refreshTimeout||"auto",execution:e.execution||"render",appearance:e.appearance||"always","feedback-enabled":e.feedbackEnabled||!0,"timeout-callback":Q}),[e.action,e.appearance,e.cData,e.execution,e.language,e.refreshExpired,e.responseField,e.responseFieldName,e.retry,e.retryInterval,e.tabIndex,e.theme,e.feedbackEnabled,e.refreshTimeout,p,s]),m=K(()=>typeof window<"u"&&!!window.turnstile,[]);return E(function(){M&&!f&&q({onLoadCallbackName:j,scriptOptions:{...o,id:P}})},[M,f,o,P]),E(function(){b!=="ready"&&me(j).then(()=>W(!0)).catch(console.error)},[]),E(function(){if(!a.current||!f)return;let u=!1;return(async()=>{if(u||!a.current)return;let _=window.turnstile.render(a.current,g);t.current=_,t.current&&x?.(t.current)})(),()=>{u=!0,t.current&&(window.turnstile.remove(t.current),h.current=!1)}},[$,f,g]),le(c,()=>{let{turnstile:n}=window;return{getResponse(){if(!n?.getResponse||!t.current||!m()){console.warn("Turnstile has not been loaded");return}return n.getResponse(t.current)},async getResponsePromise(u=3e4,B=100){return new Promise((_,k)=>{let d,H=async()=>{if(h.current&&window.turnstile&&t.current)try{let T=window.turnstile.getResponse(t.current);return d&&clearTimeout(d),T?_(T):k(new Error("No response received"))}catch(T){return d&&clearTimeout(d),console.warn("Failed to get response",T),k(new Error("Failed to get response"))}d||(d=setTimeout(()=>{d&&clearTimeout(d),k(new Error("Timeout"))},u)),await new Promise(T=>setTimeout(T,B)),await H()};H()})},reset(){if(!n?.reset||!t.current||!m()){console.warn("Turnstile has not been loaded");return}e.execution==="execute"&&y(l.invisible);try{h.current=!1,n.reset(t.current)}catch(u){console.warn(`Failed to reset Turnstile widget ${t}`,u)}},remove(){if(!n?.remove||!t.current||!m()){console.warn("Turnstile has not been loaded");return}y(l.invisible),h.current=!1,n.remove(t.current),t.current=null},render(){if(!n?.render||!a.current||!m()||t.current){console.warn("Turnstile has not been loaded or container not found");return}let u=n.render(a.current,g);return t.current=u,t.current&&x?.(t.current),e.execution!=="execute"&&y(s?l[s]:{}),u},execute(){if(e.execution!=="execute"){console.warn('Execution mode is not set to "execute"');return}if(!n?.execute||!a.current||!t.current||!m()){console.warn("Turnstile has not been loaded or container not found");return}n.execute(a.current,g),y(s?l[s]:{})},isExpired(){return!n?.isExpired||!t.current||!m()?(console.warn("Turnstile has not been loaded"),!1):n.isExpired(t.current)}}},[t,e.execution,s,g,a,m,f,x]),E(()=>{L&&!f&&window.turnstile&&W(!0)},[f,L]),E(()=>{y(z())},[e.execution,s,oe]),E(()=>{!L||typeof U!="function"||U()},[L]),we(V,{ref:a,as:te,id:$,style:{...ne,...ee},...re})});Te.displayName="Turnstile";export{A as DEFAULT_CONTAINER_ID,S as DEFAULT_ONLOAD_NAME,w as DEFAULT_SCRIPT_ID,Y as SCRIPT_URL,Te as Turnstile};
